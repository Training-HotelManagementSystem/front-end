<!DOCTYPE html>
<html lang="zxx">
<head>
<title>去 边 度 - 酒店预订</title>
<!-- custom-theme -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);
		function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //custom -->
<link href="css/index.css" rel="stylesheet"> 
<link rel="stylesheet" href="css/paymentOrder.css">
<!-- //custom-theme -->
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- //font-awesome-icons -->
<link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
</head>
<body class="bodyStyle">
<!-- header -->
<div class="banner-top">
	<div class="header">
		<div class="container">
			<div class="header-left">
				<div class="agileinfo-phone">
					<p><i class="glyphicon glyphicon-earphone" aria-hidden="true"></i> +135 8888 8888</p>
				</div>
				<div class="agileinfo-phone agileinfo-map">
					<p><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i>  D G U T</p>
				</div>
				<div class="login">
					<a href="userLogin.html">登 录</a> / <a href="userRegister.html">注 册</a>
				</div>
				<div class="clearfix"> </div>
			</div>
		</div>	
	</div>

	<div class="w3_navigation">
		<div class="container">
			<nav class="navbar navbar-default">
				<div class="navbar-header navbar-left">
					<h1><a class="navbar-brand" href="index.html"> 去 边 度 </a></h1>
				</div>
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse navbar-right" id="bs-example-navbar-collapse-1">
					<nav class="menu menu--iris">
						<ul class="nav navbar-nav menu__list">
							<li class="menu__itemt"><a href="index.html" class="menu__link">首页</a></li>
							<li class="menu__item"><a href="domesticSearch.html" class="menu__link">国内酒店</a></li>
							<li class="menu__item"><a href="foreignSearch.html" class="menu__link">国际酒店</a></li>
							<li class="menu__item"><a href="" class=""> </a></li>
						</ul>
					</nav>
				</div>
			</nav>
		</div>
	</div>
</div>
<!-- //header -->
<div class="splitLine"></div><br>
<div class="paymentOrder">
    <div class="left">
        <img class="hotelImg" src="" alt="">
        <p class="hotelName"></p>
        <p class="hotelAddr"></p> 
        <p class="roomType"></p><br>
        <div class="split"></div>
        <div class="hotelInfo">
            <table>
                <tr>
                    <td>床型:</td>
                    <td class="bedManagement"></td>
                </tr>
                <tr>
                    <td>面积:</td>
                    <td class="area"></td>
                </tr>
                <tr>
                    <td>早餐:</td>
                    <td class="breakfast"></td>
                </tr>
                <tr>
                    <td>楼层:</td>
                    <td class="floor"></td>
                </tr>
                <tr>
                    <td>可住:</td>
                    <td class="capacity"></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="right">
        <div class="info">
            <div class="bookInfo">
                <h3>预订信息</h3>
                <table>
                    <tr>
                        <td>入离时间</td>
                        <td class="time"></td>
                    </tr>
                    <tr>
                        <td>房间数量</td>
                        <td class="roomNum">
                            <div class="roomNumDiv">
                                <a href="#" onclick="subtractPrice()">-</a><input type="text" id="roomNum" value="1" readonly="readonly"><a href="#" onclick="add()">+</a>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;库存：<div class="availableRoomNum"><p id="availableRoomNum"></p></div>
							</div>
                        </td>
                    </tr>
                    <tr>
                        <td>房费总计</td>
                        <td class="charge">￥<b class="price"></b></td>
                    </tr>
                </table>
            </div>
            <div class="split"></div>
            <div class="checkInInfo">
                <h3>入住信息</h3>
                <table> 
                    <tr class="addLinkman1">
                        <td>房间1<p>*</p></td>
                        <td class="linkman"><input type="text" placeholder="输入姓名" id="linkman1"></td>
					</tr>
                    <tr>
                        <td>联系电话<p>*</p></td>
                        <td class="phone"><input type="text" placeholder="输入手机号" id="phone"></td>
					</tr>
                    <tr>
                        <td>E-mail</td>
                        <td class="email"><input type="text" placeholder="输入邮箱" id="email"></td>
                    </tr>
                </table>
            </div>
            <div></div>
            <div class="bookBtnDiv">
                <p class="chargeP"><b>支付房费&nbsp;</b></p> <p class="roomCharge">￥<b class="price" id="price"></b></p>
                <button type="button" class="bookBtn btn" onclick="submitOrder()">提交订单</button>
            </div>
        </div>
    </div>
</div>

<!-- footer -->
<div class="footer">
		<div class="container">
			<div class="agile_footer_copy">
				<div class="w3agile_footer_grids">
					<div class="col-md-4 w3agile_footer_grid">
						<h3>关于我们</h3>
						<p>???<span>???</span><span>???</span></p>
					</div>
					<div class="col-md-4 w3agile_footer_grid">
						<h3>联系方式</h3>
						<ul>
							<li><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i>D G U T</li>
							<li><i class="glyphicon glyphicon-envelope" aria-hidden="true"></i>666666666@qq.com</li>
							<li><i class="glyphicon glyphicon-earphone" aria-hidden="true"></i>+135 8888 8888</li>
						</ul>
					</div>
					<div class="col-md-4 w3agile_footer_grid w3agile_footer_grid1">
						<h3>导航</h3>
						<ul>
							<li><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><a href="index.html">首页</a></li>
							<li><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><a href="domesticSearch.html">国内酒店</a></li>
							<li><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><a href="foreignSearch.html">国际酒店</a></li>
						</ul>
					</div>
					<div class="clearfix"> </div>
				</div>
			</div>
		</div>
	</div>
	<!-- //footer -->

<!-- js -->
<script src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/bootstrap-3.1.1.min.js"></script>
<script src="js/jquery.params.js"></script>
<script>
	var price;
	var totalPrice;
	var availableRoomNum;
	var roomId = $.query.get("roomId");
	var checkIn = $.query.get("checkIn");
	var checkOut = $.query.get("checkOut");
	var hotelId;
	var userId = "";
	$(document).ready(function(){
		//获取酒店的基本信息
		$.post("http://120.79.73.26:8081/roomCategory/selectRoomCategoryById",
		{
			checkIn:checkIn,
			checkOut:checkOut,
			roomCategoryId:roomId
		},
		function(data,status){
			if(data["code"] == 0){
				//left
				console.log(data.content);
				$('.hotelImg').attr("src", data.content.hotel.photos);
				$('.hotelName').text(data.content.hotel.name);
				$('.hotelAddr').text(data.content.hotel.address);
				$('.roomType').text(data.content.name);
				$('.area').text(data.content.area);
				$('.bedManagement').text(data.content.bedManagement);
				hotelId = data.content.hotel.id;
				availableRoomNum = data.content.availableRoomNum;
				$('#availableRoomNum').text(data.content.availableRoomNum);
				if(data.content.breakfast == 0){
					var breakfast = "无早";
					$('.breakfast').text(breakfast);
				} else{
					var breakfast = "含早";
					$('.breakfast').text(breakfast);
				}
				$('.floor').text(data.content.floor);
				$('.capacity').text(data.content.capacity+'人');

				//right
				$('.time').text(checkIn+' 到 '+checkOut);
				$('.price').text(data.content.price);
				price = data.content.price;
				totalPrice = price;
				$('.capacity').text(data.content.capacity+'人');
			}
		});
	});
	function subtractPrice(){
		var num = Number($('#roomNum').val());
		if(num > 1){
			totalPrice -= price;
			num = num - 1;
			var asd = ".addLinkman"+Number($('#roomNum').val());
			$(".addLinkman"+Number($('#roomNum').val())).remove();
			$(".right").css("height", $(".right").height()-50);
			$(".paymentOrder").css("height", $(".paymentOrder").height()-50);
		}
		$('#roomNum').val(num);
		$('.price').text(totalPrice);
	}
	function add(){
		if(Number($('#roomNum').val() < availableRoomNum)){
			totalPrice += price;
			var num = Number($('#roomNum').val());
			num = num + 1;
			$('#roomNum').val(num);
			$('.price').text(totalPrice);
			var linkmanDiv = "<tr class=\"addLinkman"+num+"\"><td>房间"+num+"<p>*</p></td><td class=\"linkman\"><input type=\"text\" placeholder=\"输入姓名\" id=\"linkman"+num+"\"></td></tr>";
			$(".addLinkman"+(num-1)).after(linkmanDiv);
			$(".right").css("height", $(".right").height()+50);
			$(".paymentOrder").css("height", $(".paymentOrder").height()+50);
		}
	}
	function submitOrder(){
		var linkman;
		for(var i = 0; i < Number($('#roomNum').val()); i ++){
			if(i == 0){
				linkman = $('#linkman1').val();
			} else{
				linkman += '#';
				var j = i + 1;
				linkman += $('#linkman'+j).val();
			}
		}
		var roomNum = $('#roomNum').val();
		var phone = $('#phone').val();
		var email = $('#email').val();
		$.post("http://120.79.73.26:8081/order/addOrder",
		{
			checkInTime:checkIn,
			checkOutTime:checkOut,
			email:email,
			hotelId:hotelId,
			linkman:linkman,
			num:roomNum,
			phone:phone,
			roomcategoryId:roomId,
			totalPrice:totalPrice,
			userId:userId
		},
		function(data,status){
			if(data["code"] == 0){
				var orderId = data.content;
				window.location.href='pay.html?orderId='+orderId;
			}
		});
	}
</script>
<!-- //js -->
</body>
</html>